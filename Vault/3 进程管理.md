# 3 进程管理
现代操作系统围绕进程管理设计
> 现代操作系统特点：程序并发执行 系统资源共享 用户随机地使用系统

## 程序的顺序执行
> 一个具有独立功能的程序独占处理机直至最终结束的过程称为程序的顺序执行

- 顺序性：
程序顺序执行时，其执行过程可以看作一系列严格按程序规定的状态转移过程
- 封闭性：
程序执行得到的最终结果由给定的初始条件决定，不受外界因素影响 ^7a1e8a
- 可再现性：
只要输入初始条件相同，无论何时执行该程序都会得到相同的结果 ^6e3dde

### 多程序情境下程序执行环境的变化
- 独立性 ^bcc7e9
- 随机性
- 资源共享：资源共享将导致对进程执行速度的制约
资源共享将导致对程序执行速度的制约

### 程序的并发执行
> 程序是一个在时间上严格次序前后相继操作的序列，是静态的概念

并发执行是为了增强计算机系统的处理能力和提高资源利用率所采取的一种同时操作技术，可以分为两种：
1. 多道程序系统的程序执行环境变化所引起的多道程序的并发执行。多道程序的并发执行在宏观上是同时进行的，但在微观上（指令级上）是顺序执行的。
2. 在某道程序的几个程序段中（例如几个程序），包含着一部分可以同时执行或顺序颠倒执行的代码。
> 它们既可以同时执行，也可颠倒次序执行。这样的语句，同时执行不会改变顺序程序的逻辑性质。因此，可以采用并发执行来充分利用系统资源以提高计算机的处理能力

- 程序的并发执行概念解读：
> 一组在逻辑上互相独立的程序或程序段，在执行过程中其执行时间在客观上互相重叠，即一个程序段的执行尚未结束，另一个程序段的执行已经开始的执行方式。

- 程序并发执行带来的影响
  - 两段并发执行的程序对**共享资源堆栈**发生了指令级交叉
- 要必须有一个描述各程序段执行过程和共享资源的基本单位。

若不按照规则进行并发竞争，则会不可避免地失去[[#^7a1e8a]]和[[#^6e3dde]]


## 进程
> 进程是可以并发执行的计算部分（S. E. Madnick，J. T. Donovan）
> 进程是一个独立的可以调度的活动（E. Cohen，D. Jofferson）
> 进程是一个抽象实体，当它执行某个任务时，将要分配和释放各种资源（P. Denning）
> 行为的规则是程序，程序在处理机上执行时的活动称为进程（E. W. Dijkstra）
> 一个进程是一系列逐一执行的操作，而操作的确切含义则有赖于以何种详尽程度来描述进程（Brinch Hansen）

**进程是一个动态的执行过程**
- 定义：
>一个具有**独立功能的程序**对某个数据集在处理机上的**执行过程和分配资源**的基本单位，其中程序指一组操作序列，数据集是接受程序规定操作的一组存储单元的内容。

- 进程是一个动态概念，程序是一个静态概念。
程序是指令的有序集合，没有任何执行的含义。进程强调执行过程，它动态地被创建，并被调度执行后消亡。
- 进程具有并发特征，程序没有。
进程具有独立性和异步性。即不考虑资源共享的情况下，各进程的执行是独立的，执行速度是异步的。**程序一旦运行之后就是一个进程**
- 进程是竞争计算机系统资源的基本单位，从而其并发性受到系统的制约（对进程独立性和异步性的限制）。
- 不同的进程可以包含同一程序，只要该程序所对应的数据集不同。（在不同的数据集上运行 只要运行就是一个进程）

> 操作系统是一个资源管理模型

> 进程的静态描述：描述进程存在和能够反映其变化的物理实体。

### 进程的描述
进程的静态描述由三部分组成：
- 进程控制块PCB
- 有关程序段
- 该程序段操作的数据集。

**PCB和数据集这两部分内容放在外存中，直到该进程执行时再调入内存。**

### **进程PCB**
- 系统根据PCB感知进程的存在和通过PCB中所包含的各项变量的变化，掌握进程所处的状态以达到控制进程活动的目的。
- 进程的PCB是系统感知进程的唯一实体。在几乎所有的多道操作系统中，进程的PCB结构都是全部或部分常驻内存的。

进程开始：
1. 创建PCB
2. 当一个进程完成其功能之后，系统释放PCB
3. 进程消亡

#### 描述信息
- 进程名或标识号
- 用户名或用户标识号
- 家族关系：每个进程必定有一个父进程
#### 控制信息
- 进程当前状态
    1. 初始状态：创建进程申请资源无法满足时创建工作尚未完成，进程无法被调度运行。
    2. 就绪状态：进程可运行，需等待调度程序为其分配处理机
    3. 执行状态：
    4. 等待状态：因为外部事件而暂时不能占有处理机
- 进程优先级
    1. 占有CPU时间
    2. 进程优先级偏移
    3. 占据内存时间
- 程序的开始地址
- 资源管理信息
    1. 占有内存大小及其管理用数据结构指针
    2. 复杂系统中对换或者覆盖用的有关信息
    3. 共享程序段的大小和起始地址
- 现场保护结构

单CPU系统中，任意时刻处于执行状态的进程只有一个。
#### 组织方式
- 线性方式
将系统中所有的PCB都组织在一张线性表中，将该表的首址存放在内存的一个专用区域中。
- 链接方式
把具有相同状态的进程的PCB通过PCB中的链接字链接成一个队列，形成就绪队列、若干个阻塞队列和空白队列等。
- 索引方式
### 进程上下文
> 进程上下文是一个抽象的概念，包含进程执行过的、执行时的以及待执行的指令和数据，是存储在指令寄存器、堆栈（调用子程序的返回点和参数等）、状态字寄存器等中的内容。
- **静态部分**
- **动态部分**

- 上文：已执行过的进程指令和数据。
- 正文：正在执行的进程指令和数据。
- 下文：待执行的进程指令和数据。
### 进程上下文切换
### 进程空间

### 进程状态
内存就绪状态和外存就绪状态——为了有效利用内存。
一个进程在其生命周期中，可能涉及：用户程序和操作系统内核程序。——便于程序的共享和保护。

等待状态可根据等待时间种类进一步划分为不同的子状态。
使系统控制简单，发现和唤醒相应的进程更加容易。

#### 进程状态转换
- 反映进程执行过程的变化。
- 随着进程执行和外界条件发生变化和转换。
- 某些情况需要硬件触发器才能完成。

就绪 = 静止就绪+活动就绪
等待（阻塞）= 静止阻塞 + 活动阻塞

## 进程控制
进程和处理机管理的一个重要任务是进程控制
>  系统使用具有特定功能的程序段来创建，撤销进程以及完成各个进程之间的转换。实现资源共享。

### 原语
> 一般地，把系统态下执行的某些具有特定功能的程序段称为原语
- 机器指令集原语：执行期间不允许中断
- 功能级原语：作为原语程序段不允许并发症行
**原语目的是为了完成系统管理的某个功能和被高层软件调用**

### 进程创建
- 创建时由操作系统承担一部分资源分配和管理。
1. 由系统程序模块统一创建
	进程之间的关系平等
2. 由父进程创建
	进程之间存在隶属关系 也存在继承关系
创建时使用创建原语

### 进程撤销
进程撤销关联着资源的释放以及PCB的释放
1. 进程完成
2. 进程错误中止
3. 祖先进程要求撤销某个子进程

###进程阻塞
发生条件不具备 进程调用阻塞原语来阻塞自己
进程从执行状态变为等待状态
### 进程唤醒
系统进程唤醒等待进程 一系列程序进程都被唤醒
事件发生进程唤醒时，事件发生进程和被唤醒进程之间是合作关系。
唤醒进程——调用唤醒原语的进程

## 进程互斥
由于资源有限，进程并发执行的过程中存在资源竞争和共享
### 资源共享所引起的制约
- 临界区
程序中所描述的一条语句，是由多条执行指令构成的。
控制进程的执行速度和进程之间的资源竞争

不允许多个并发程序交叉执行的一段程序称为临界部分
临界区是由属于不同并发进程的程序段共享共用数据或公用数据变量引起的。
- 间接制约
各个并发进程的速度受共有资源制约，而不是进程间直接制约的意思

- 互斥
> 不允许两个以上的共享该资源的并发进程同时进入临界区