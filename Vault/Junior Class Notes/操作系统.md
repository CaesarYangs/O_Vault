## Overview
操作系统概述
处理器管理
内存管理
文件系统
外设管理
操作系统体系结构

- 学堂在线-操作系统
- 实验内容
物理内存管理，虚拟内存管理，用户进程管理，调度器，同步互斥
- 考试周考试70%
- 4学分
- 理论课+实验课
---
- [绪论](#1-绪论)
- [操作系统用户界面](#2-操作系统用户界面)
- [进程管理](#3-进程管理)


## 1 绪论
### 1.1概念
裸机-操作系统-编译and编辑软件-各种应用软件
- 内核态：操作系统层级（最高权限）
- 用户态：软件+应用软件（基础权限）
	- 当cpu被操作系统的代码掌控时转为内核态
>  操作系统是一个资源管理模型

操作系统是计算机系统中的一个系统软件，它是这样一些程序模块的集合——它们管理和控制计算机系统中的硬件及软件资源，合理地组织计算机工作流程，以便有效地利用这些资源为用户提供一个功能强大、使用方便和可扩展的工作环境，从而在计算机与其用户之间起到接口的作用。

### 早期批处理
批处理-即将作业（Jobs）打包执行。 解决手工作业效率低的问题
>联机 脱机：指的是IO输入输出设备和主机之间
1. 联机批处理
慢速的IO设备和主机直接相连
- 解决了作业转接 减少了操作时间
- CPU串行等待 时间仍有很大浪费
2. 脱机批处理
**添加卫星机-不与主机直接相连而专门用于输入输出**
- 主机与卫星机并行工作
- 充分发挥主机的高速计算能力
- 促进了**监督程序**的发展
	- 编译 链接 输出
3. 执行系统阶段
通道（IO控制）和中断（随时响应请求）技术
**输入输出控制 编译 链接**——>***执行系统***

### 多道程序系统
批处理系统每次只调用一个用户作业程序进入内存并运行——*单道运行*
每次调用多个用户作业——*多道程序系统*
- 单处理器系统多道程序特点：
	1. 多道：内存中存放几道相互独立的程序。
	2. 宏观并行：内存中程序都在运行中，都没有结束。
	3. 微观串行：轮流使用CPU 交替执行。    *并发——交替执行*

- 分时操作系统——*实时在线 联机可交互*
提高了资源利用率和系统吞吐率 更高一级的人机交互需求被提出来
即时与作业交互+共享主机
- 实时操作系统——*快速*
- 通用操作系统
	- 实时作业——前台作业
	- 批处理——后台作业

- 分布式系统
使用统一操作系统 对用户透明

### 1.4 操作系统功能
- 处理机管理
> 处理机管理功能：针对多道程序或多用户情况，解决组织多个作业同时运行时面对的处理机分配调度策略、分配实施和资源回收等问题。

- CPU-
使用规则-执行
- 存储-
内存＆外存-分配 *保证系统及用户程序存储区互不冲突* 设置读写权限
存储保护 *保证用户程序不会破坏系统程序*
内存扩充 *把内存和外存结合起来管理 整合成虚拟存储器*

#### 设备管理
虚拟技术＆缓冲技术
#### 信息管理（文件系统管理）
子目录 逻辑形式文件系统 
应允许共享信息文件
#### 用户接口
程序一级接口：一组广义指令 供用户程序和其它系统调用
作业一级接口：Shell命令

#### 主要寄存器
1. 用户可编程寄存器
	1. 存储寄存器：内容为操作数，运算结果等信息。**对数据进行操作的任何机器指令都被允许访问数据寄存器。**
	2. 地址寄存器：**存放内存中某个数据或指令的地址，或某段数据与指令的入口地址**
2. 控制与状态寄存器
	1. 程序计数器PC：当前存放的要执行指令的地址
	2. 指令寄存器IR：存放当前正在执行的指令
	3. 状态寄存器：**体现当前指令执行结果的各种状态信息（条件码）**  条件码寄存器的比特位由处理机硬件设置。
	4. 中断现场保护寄存器：用于保存被中断程序的现场以便链接中断恢复处
	5. 过程调用堆栈：**存放过程调用时的调用名、调用参数、以及返回地址等。**
	6. 程序状态字PSW：**程序状态字指CPU一些重要寄存器内容的有序集合，能够反映程序运行状态**

#### 操作系统几种视角
- 计算机资源管理者
- 提供用户交互界面
- 进程管理者
> 进程是一个程序动态的执行过程

---
## 2 操作系统用户界面
应用程序用户or程序开发人员

### 作业及其输入输出
#### 作业
编辑编译链接执行——一个作业步
作业由不同的顺序相连的作业步组成
作业是比程序更广的概念
> 作业 = 程序+数据+作业说明书
> **在批处理系统中，作业是抢占内存的基本单位。也就是说，批处理系统以作业为单位把程序和数据调入内存以便执行。**

- 一个作业可以包含多个程序和多个数据集，但必须至少包含一个程序。否则不能称之为作业
- 作业中包含的程序和数据完成用户所要求的的业务处理工作
- **作业说明书体现用户的控制意图，主要包含：作业的基本描述、作业控制描述和资源要求描述。**

> **作业说明书在系统中生成一个称为作业控制块(job control block，JCB)** 以表格的形式存在

#### 作业输入输出方式
1. 联机输入方式
**外围设备直接和主机相连接。一台主机可以连接一台或多台外围设备。**
2. 脱机输入方式：
**脱机输入方式利用低档个人计算机作为外围处理机进行输入处理。**
3. 直接耦合方式
**把主机和外围低档机通过一个公用的大容量外存直接耦合起来**
4. SPOOLING方式
不直接对IO设备操作 使用通道对大型存储设备操作 解放CPU
5. 网络输入方式
涉及到计算机之间的通信

### 用户界面

#### 命令控制界面
- 脱机控制方式
	- 规定作业执行顺序 出错处理方法的作业控制程序
> 系统按照作业说明书或命令文件中规定的顺序控制作业执行
- 联机控制方式
	- 不要求提供作业说明书
> 用户使用系统提供的操作命令和系统会话，交互的控制程序执行和管理计算机系统

#### 系统调用
- 设备管理 存储管理 文件管理
>  进程是一个在功能上独立的、程序的一次执行过程。进程是一个动态的概念
- 进程控制
- 进程通信
- 线程管理

--- 

## 3 进程管理
现代操作系统围绕进程管理设计
> 现代操作系统特点：程序并发执行 系统资源共享 用户随机地使用系统

### 程序的顺序执行
> 一个具有独立功能的程序独占处理机直至最终结束的过程称为程序的顺序执行

- 顺序性：
程序顺序执行时，其执行过程可以看作一系列严格按程序规定的状态转移过程
- 封闭性：
程序执行得到的最终结果由给定的初始条件决定，不受外界因素影响 ^7a1e8a
- 可再现性：
只要输入初始条件相同，无论何时执行该程序都会得到相同的结果 ^6e3dde

### 多程序情境下程序执行环境的变化
- 独立性 ^bcc7e9
- 随机性
- 资源共享：资源共享将导致对进程执行速度的制约
资源共享将导致对程序执行速度的制约

### 程序的并发执行
> 程序是一个在时间上严格次序前后相继操作的序列，是静态的概念

并发执行是为了增强计算机系统的处理能力和提高资源利用率所采取的一种同时操作技术，可以分为两种：
1. 多道程序系统的程序执行环境变化所引起的多道程序的并发执行。多道程序的并发执行在宏观上是同时进行的，但在微观上（指令级上）是顺序执行的。
2. 在某道程序的几个程序段中（例如几个程序），包含着一部分可以同时执行或顺序颠倒执行的代码。
> 它们既可以同时执行，也可颠倒次序执行。这样的语句，同时执行不会改变顺序程序的逻辑性质。因此，可以采用并发执行来充分利用系统资源以提高计算机的处理能力

- 程序的并发执行概念解读：
> 一组在逻辑上互相独立的程序或程序段，在执行过程中其执行时间在客观上互相重叠，即一个程序段的执行尚未结束，另一个程序段的执行已经开始的执行方式。

- 程序并发执行带来的影响
  - 两段并发执行的程序对**共享资源堆栈**发生了指令级交叉
- 要必须有一个描述各程序段执行过程和共享资源的基本单位。

若不按照规则进行并发竞争，则会不可避免地失去[[#^7a1e8a]]和[[#^6e3dde]]


### 进程
> 进程是可以并发执行的计算部分（S. E. Madnick，J. T. Donovan）
> 进程是一个独立的可以调度的活动（E. Cohen，D. Jofferson）
> 进程是一个抽象实体，当它执行某个任务时，将要分配和释放各种资源（P. Denning）
> 行为的规则是程序，程序在处理机上执行时的活动称为进程（E. W. Dijkstra）
> 一个进程是一系列逐一执行的操作，而操作的确切含义则有赖于以何种详尽程度来描述进程（Brinch Hansen）

**进程是一个动态的执行过程**
- 定义：
>一个具有**独立功能的程序**对某个数据集在处理机上的**执行过程和分配资源**的基本单位，其中程序指一组操作序列，数据集是接受程序规定操作的一组存储单元的内容。

- 进程是一个动态概念，程序是一个静态概念。
程序是指令的有序集合，没有任何执行的含义。进程强调执行过程，它动态地被创建，并被调度执行后消亡。
- 进程具有并发特征，程序没有。
进程具有独立性和异步性。即不考虑资源共享的情况下，各进程的执行是独立的，执行速度是异步的。**程序一旦运行之后就是一个进程**
- 进程是竞争计算机系统资源的基本单位，从而其并发性受到系统的制约（对进程独立性和异步性的限制）。
- 不同的进程可以包含同一程序，只要该程序所对应的数据集不同。（在不同的数据集上运行 只要运行就是一个进程）

> 操作系统是一个资源管理模型

> 进程的静态描述：描述进程存在和能够反映其变化的物理实体。

#### 进程的描述
进程的静态描述由三部分组成：
- 进程控制块PCB
- 有关程序段
- 该程序段操作的数据集。

**PCB和数据集这两部分内容放在外存中，直到该进程执行时再调入内存。**

#### **进程PCB**
- 系统根据PCB感知进程的存在和通过PCB中所包含的各项变量的变化，掌握进程所处的状态以达到控制进程活动的目的。
- 进程的PCB是系统感知进程的唯一实体。在几乎所有的多道操作系统中，进程的PCB结构都是全部或部分常驻内存的。

进程开始：
1. 创建PCB
2. 当一个进程完成其功能之后，系统释放PCB
3. 进程消亡

##### 描述信息
- 进程名或标识号
- 用户名或用户标识号
- 家族关系：每个进程必定有一个父进程
##### 控制信息
- 进程当前状态
    1. 初始状态：创建进程申请资源无法满足时创建工作尚未完成，进程无法被调度运行。
    2. 就绪状态：进程可运行，需等待调度程序为其分配处理机
    3. 执行状态：
    4. 等待状态：因为外部事件而暂时不能占有处理机
- 进程优先级
    1. 占有CPU时间
    2. 进程优先级偏移
    3. 占据内存时间
- 程序的开始地址
- 资源管理信息
    1. 占有内存大小及其管理用数据结构指针
    2. 复杂系统中对换或者覆盖用的有关信息
    3. 共享程序段的大小和起始地址
- 现场保护结构

##### 组织方式
- 线性方式
将系统中所有的PCB都组织在一张线性表中，将该表的首址存放在内存的一个专用区域中。
- 链接方式
把具有相同状态的进程的PCB通过PCB中的链接字链接成一个队列，形成就绪队列、若干个阻塞队列和空白队列等。
- 索引方式
#### 进程上下文
> 进程上下文是一个抽象的概念，包含进程执行过的、执行时的以及待执行的指令和数据，是存储在指令寄存器、堆栈（调用子程序的返回点和参数等）、状态字寄存器等中的内容。
- **静态部分**
- **动态部分**

- 上文：已执行过的进程指令和数据。
- 正文：正在执行的进程指令和数据。
- 下文：待执行的进程指令和数据。
#### 进程上下文切换
#### 进程空间